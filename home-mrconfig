# -*- mode: sh -*-

[DEFAULT]
include = cat /usr/local/lib/mr/stow

lib =
  error(){ printf "\033[1m\033[31mERROR: $@\033[m\n"; exit 1; }
  warning(){ printf "\033[1m\033[1;33mWARNING: $@\033[m\n"; }
  info(){ printf "\033[1m\033[33m $@\033[m\n"; }
  hostname="$(hostname)"
  whoami="$(whoami)"
  anon(){
    ( GIT_CONFIG_HOME=$HOME/.git/config remote.origin.url || \
      cat .git/remotes/origin ) | grep -q 'git://'
  }
  on(){
    for host in "$@"; do
		  if [ "${host%@*}" != "${host#*@}" ]; then
			  if [ "$whoami" != "${host%@*}" ]; then
				  continue
				fi
				host="${host#*@}"
			fi
			if [ "$hostname" = "$host" ]; then
				return 0
			fi
		done
		return 1
	}
	myworkstation() {
		on wandsas@z620
	}
  checkprivs(){
	  find "$MR_REPO" -type f -exec chmod 600 {} \;
	  find "$MR_REPO" -type d -exec chmod 700 {} \;
    info "Privileges checked for $MR_NAME"
    stat -c "%a %n" $MR_REPO | info "$MR_NAME $(awk '{print $1}')"
   # stat -c "%a %n" $MR_REPO/* | info "$MR_NAME $(awk '{print $1}')"
  }
  mr_init_stow_package () {
    : ${STOW_PKG_TYPE:=symlink}
    STOW_NO_AUTOMATIC_ACTIONS=yes
    set_stow_common_opts
  }

[$HOME/repos/wandsas/mr-config]
name = mr-config
order = 1
checkout = git clone git@rpi3.lan:/repos/wandsas/mr-config $MR_REPO
post_checkout =
  cd "MR_REPO && git remote add gitlab git@gitlab.com:sawander/mr-config.git
# This loads repos/wandsas/mr-config/.mrconfig
chain = false
fixups =
  ln -sf "$MR_REPO/home-mrconfig" ~/.mrconfig
  ln -sf "$MR_REPO/.stow-global-ignore" ~

[$HOME/repos/wandsas/shell-env]
checkout = git clone git@rpi3.lan:/repos/wandsas/shell-env
remotes = git remote add gitlab ssh://git@gitlab.com/sawander/shell-env.git
lib = MR_FOLD=
stowable = true

[$HOME/repos/wandsas/mail-config]
checkout = git clone git@rpi3.lan:/repos/wandsas/mail-config
remotes = git remote add gitlab ssh://git@gitlab.com/sawander/mail-config.git
stowable = true
fixups = checkprivs 
skip = ! myworkstation

[$HOME/repos/wandsas/vim-config]
checkout = git clone git@rpi3.lan:/repos/wandsas/vim-config
remotes = git remote add gitlab ssh://git@gitlab.com/sawander/vim-config.git
stowable = true

[$HOME/repos/wandsas/sway-desktop]
checkout = git clone git@rpi3.lan:/repos/wandsas/sway-desktop
remotes = git remote add gitlab ssh://git@gitlab.com/sawander/sway-desktop.git
lib = MR_FOLD=
stowable = true

[$HOME/repos/wandsas/xorg-desktop]
checkout = git clone git@rpi3.lan:/repos/wandsas/xorg-desktop
remotes = git remote add gitlab ssh://git@gitlab.com/sawander/xorg-desktop.git
stowable = true
skip = true

[$HOME/repos/wandsas/git-config]
checkout = git clone git@rpi3.lan:/repos/wandsas/git-config
remotes = git remote add gitlab ssh://git@gitlab.com/sawander/mygit.git
stowable = true

[$HOME/.gnupg]
checkout = git clone ssh://git@rpi3.lan:/repos/wandsas/gnupg-config $MR_REPO
fixups = checkprivs
skip = ! myworkstation

[$HOME/.ssh]
checkout = git clone ssh://git@rpi3.lan:/repos/wandsas/ssh-config $MR_REPO
fixups = checkprivs
skip = ! myworkstation

[$HOME/.password-store]
checkout = git clone ssh://git@rpi3.lan:/repos/wandsas/password-store $MR_REPO
fixups = checkprivs
skip = ! myworkstation

# vim: ft=dosini ts=2 sts=2 sw=2 et
